{"version":3,"file":"d3plus-timeline.js","sources":["../src/Timeline.js"],"sourcesContent":["/**\n    @external Axis\n    @see https://github.com/d3plus/d3plus-axis#Axis\n*/\nimport {max} from \"d3-array\";\nimport {brushX} from \"d3-brush\";\nimport {scaleTime} from \"d3-scale\";\nimport {pointer} from \"d3-selection\";\n\nimport {Axis, date} from \"d3plus-axis\";\nimport {colorDefaults} from \"d3plus-color\";\nimport {attrize, closest, elem} from \"d3plus-common\";\nimport {textWidth, textWrap} from \"d3plus-text\";\n\n/**\n    @class Timeline\n    @extends external:Axis\n*/\nexport default class Timeline extends Axis {\n\n  /**\n      @memberof Timeline\n      @desc Invoked when creating a new class instance, and overrides any default parameters inherited from Axis.\n      @private\n  */\n  constructor() {\n\n    super();\n\n    this._barConfig = Object.assign({}, this._barConfig, {\n      \"stroke-width\": () => this._buttonBehaviorCurrent === \"buttons\" ? 0 : 1\n    });\n    this._brushing = true;\n    this._brushFilter = event => !event.button && event.detail < 2;\n    this._buttonAlign = \"middle\";\n    this._buttonBehavior = \"auto\";\n    this._buttonPadding = 10;\n    this._buttonHeight = 30;\n    this._domain = [2001, 2010];\n    this._gridSize = 0;\n    this._handleConfig = {\n      fill: colorDefaults.dark\n    };\n    this._handleSize = 6;\n    this._height = 100;\n    this._labelOffset = false;\n    this._on = {};\n    this.orient(\"bottom\");\n    this._scale = \"time\";\n    this._selectionConfig = {\n      \"fill\": \"#999\",\n      \"stroke-width\": 0\n    };\n    this._shape = \"Rect\";\n    this._shapeConfig = Object.assign({}, this._shapeConfig, {\n      labelBounds: d => this._buttonBehaviorCurrent === \"buttons\" ? {x: d.labelBounds.x, y: -5, width: d.labelBounds.width, height: this._buttonHeight} : d.labelBounds,\n      fill: () => this._buttonBehaviorCurrent === \"buttons\" ? colorDefaults.light : colorDefaults.dark,\n      height: d => this._buttonBehaviorCurrent === \"buttons\" ? this._buttonHeight : d.tick ? 10 : 0,\n      width: d => this._buttonBehaviorCurrent === \"buttons\" ? this._ticksWidth / this._availableTicks.length : d.tick ? this._domain.map(t => date(t).getTime()).includes(d.id) ? 2 : 1 : 0,\n      y: d => this._buttonBehaviorCurrent === \"buttons\" ? this._align === \"middle\" ? this._height / 2 : this._align === \"start\" ? this._margin.top + this._buttonHeight / 2 : this._height - this._buttonHeight / 2 - this._margin.bottom : d.y\n    });\n    this._snapping = true;\n\n  }\n\n\n  /**\n      @memberof Timeline\n      @desc Triggered on brush \"brush\".\n      @private\n  */\n  _brushBrush(event) {\n\n    if (event.sourceEvent && event.sourceEvent.offsetX && event.selection !== null && (!this._brushing || this._snapping)) {\n\n      const domain = this._updateDomain(event);\n\n      this._brushGroup.call(this._brush.move, this._updateBrushLimit(domain));\n\n    }\n\n    this._brushStyle();\n    if (this._on.brush) this._on.brush(this._selection);\n\n  }\n\n  /**\n      @memberof Timeline\n      @desc Triggered on brush \"end\".\n      @private\n  */\n  _brushEnd(event) {\n\n    if (!event.sourceEvent) return; // Only transition after input.\n\n    const domain = this._updateDomain(event);\n\n    this._brushStyle();\n\n    if (this._brushing || !this._snapping) this._brushGroup.transition(this._transition).call(this._brush.move, this._updateBrushLimit(domain));\n\n    if (this._on.end) this._on.end(this._selection);\n\n  }\n\n  /**\n      @memberof Timeline\n      @desc Triggered on brush \"start\".\n      @private\n  */\n  _brushStart(event) {\n\n    if (event.sourceEvent !== null && (!this._brushing || this._snapping)) {\n\n      const domain = this._updateDomain(event);\n      this._brushGroup.call(this._brush.move, this._updateBrushLimit(domain));\n\n    }\n\n    this._brushStyle();\n    if (this._on.start) this._on.start(event);\n\n  }\n\n  /**\n      @memberof Timeline\n      @desc Overrides the default brush styles.\n      @private\n  */\n  _brushStyle() {\n\n    const {height} = this._position;\n    const timelineHeight = this._shape === \"Circle\"\n      ? typeof this._shapeConfig.r === \"function\" ? this._shapeConfig.r({tick: true}) * 2 : this._shapeConfig.r\n      : this._shape === \"Rect\"\n        ? typeof this._shapeConfig[height] === \"function\" ? this._shapeConfig[height]({tick: true}) : this._shapeConfig[height]\n        : this._tickSize;\n\n    const brushOverlay = this._brushGroup.selectAll(\".overlay\")\n      .attr(\"cursor\", this._brushing ? \"crosshair\" : \"pointer\");\n\n    const brushSelection = this._brushGroup.selectAll(\".selection\")\n      .call(attrize, this._selectionConfig)\n      .attr(\"height\", timelineHeight);\n\n    const brushHandle = this._brushGroup.selectAll(\".handle\")\n      .call(attrize, this._handleConfig)\n      .attr(\"height\", this._buttonBehaviorCurrent === \"buttons\" ? this._buttonHeight : timelineHeight + this._handleSize);\n\n    if (this._buttonBehaviorCurrent === \"buttons\") {\n\n      const yTransform = this._align === \"middle\"\n        ? this._height / 2 - this._buttonHeight / 2\n        : this._align === \"start\"\n          ? this._margin.top : this._height - this._buttonHeight - this._margin.bottom;\n\n      brushHandle.attr(\"y\", yTransform);\n      brushOverlay.attr(\"x\", this._marginLeft).attr(\"width\", this._ticksWidth);\n      brushSelection.attr(\"y\", yTransform);\n    }\n\n  }\n\n  /**\n      @memberof Timeline\n      @desc Updates domain of the timeline used in brush functions.\n      @private\n  */\n  _updateDomain(event) {\n\n    const x = pointer(event, this._select.node())[0];\n    let domain = event.selection && this._brushing ? event.selection : [x, x];\n\n    if (this._buttonBehaviorCurrent === \"ticks\") domain = domain.map(this._d3Scale.invert);\n    domain = domain.map(Number);\n\n    if (event.type === \"brush\" && this._brushing && this._buttonBehaviorCurrent === \"buttons\") {\n      const diffs = event.selection.map(d => Math.abs(d - event.sourceEvent.offsetX));\n\n      domain = diffs[1] <= diffs[0]\n        ? [event.selection[0], event.sourceEvent.offsetX].sort((a, b) => a - b)\n        : [event.sourceEvent.offsetX, event.selection[1]].sort((a, b) => a - b);\n\n    }\n\n    const ticks = this._buttonBehaviorCurrent === \"ticks\"\n      ? this._availableTicks.map(Number)\n      : this._d3Scale.range();\n\n    if (this._buttonBehaviorCurrent === \"ticks\") {\n      domain[0] = date(closest(domain[0], ticks));\n      domain[1] = date(closest(domain[1], ticks));\n    }\n    else {\n      domain[0] = closest(domain[0], ticks);\n      domain[1] = closest(domain[1], ticks);\n    }\n\n    const single = +domain[0] === +domain[1];\n\n    if (event.type === \"brush\" || event.type === \"end\") {\n      this._selection = this._buttonBehaviorCurrent === \"ticks\"\n        ? single ? domain[0] : domain\n        : single\n          ? date(this._availableTicks[ticks.indexOf(domain[0])])\n          : [date(this._availableTicks[ticks.indexOf(domain[0])]), date(this._availableTicks[ticks.indexOf(domain[1])])];\n    }\n\n    return domain;\n\n  }\n\n  /**\n      @memberof Timeline\n      @desc Updates limits of the brush.\n      @private\n  */\n  _updateBrushLimit(domain) {\n\n    const selection = this._buttonBehaviorCurrent === \"ticks\" ? domain.map(date).map(this._d3Scale) : domain;\n\n    if (selection[0] === selection[1]) {\n      selection[0] -= 0.1;\n      selection[1] += 0.1;\n    }\n\n    if (this._buttonBehaviorCurrent === \"buttons\") {\n      const buttonWidth = 0.5 * (this._ticksWidth / this._availableTicks.length - this._handleSize);\n      selection[0] -= buttonWidth;\n      selection[1] += buttonWidth;\n    }\n\n    return selection;\n  }\n\n  /**\n      @memberof Timeline\n      @desc Draws the timeline.\n      @param {Function} [*callback* = undefined]\n      @chainable\n  */\n  render(callback) {\n    const {height, y} = this._position;\n\n    if (this._buttonBehavior !== \"ticks\") {\n\n      let ticks = this._ticks ? this._ticks.map(date) : this._domain.map(date);\n\n      const d3Scale = scaleTime().domain(ticks).range([0, this._width]);\n\n      ticks = this._ticks ? ticks : d3Scale.ticks();\n\n      if (!this._tickFormat) this._tickFormat = d3Scale.tickFormat(ticks.length - 1, this._tickSpecifier);\n\n      // Measures size of ticks\n      let maxLabel = 0;\n      ticks.forEach((d, i) => {\n        const f = this._shapeConfig.labelConfig.fontFamily(d, i),\n              s = this._shapeConfig.labelConfig.fontSize(d, i);\n\n        const wrap = textWrap()\n          .fontFamily(f)\n          .fontSize(s)\n          .lineHeight(this._shapeConfig.lineHeight ? this._shapeConfig.lineHeight(d, i) : undefined);\n\n        const res = wrap(d3Scale.tickFormat(ticks.length - 1, this._tickSpecifier)(d));\n        let width = res.lines.length\n          ? Math.ceil(max(res.lines.map(line => textWidth(line, {\"font-family\": f, \"font-size\": s})))) + s / 4\n          : 0;\n        if (width % 2) width++;\n        if (maxLabel < width) maxLabel = width + 2 * this._buttonPadding;\n      });\n\n      this._ticksWidth = maxLabel * ticks.length;\n    }\n\n    this._buttonBehaviorCurrent = this._buttonBehavior === \"auto\" ? this._ticksWidth < this._width ? \"buttons\" : \"ticks\" : this._buttonBehavior;\n\n    if (this._buttonBehaviorCurrent === \"buttons\") {\n      this._scale = \"ordinal\";\n      this._labelRotation = 0;\n      if (!this._brushing) this._handleSize = 0;\n      const domain = scaleTime().domain(this._domain.map(date)).ticks().map(this._tickFormat).map(Number);\n\n      this._domain = this._ticks ? this._ticks.map(date) : Array.from(Array(domain[domain.length - 1] - domain[0] + 1), (_, x) => domain[0] + x).map(date);\n\n      this._ticks = this._domain;\n\n      const buttonMargin = 0.5 * this._ticksWidth / this._ticks.length;\n\n      this._marginLeft = this._buttonAlign === \"middle\"\n        ? (this._width - this._ticksWidth) / 2 : this._buttonAlign === \"end\"\n          ? this._width - this._ticksWidth : 0;\n\n      const marginRight = this._buttonAlign === \"middle\"\n        ? (this._width + this._ticksWidth) / 2 : this._buttonAlign === \"start\"\n          ? this._ticksWidth : undefined;\n\n      this._range = [\n        this._buttonAlign === \"start\" ? undefined : this._marginLeft + buttonMargin,\n        this._buttonAlign === \"end\" ? undefined : marginRight - buttonMargin\n      ];\n    }\n\n    if (this._ticks) this._domain = this._buttonBehaviorCurrent === \"ticks\" ? [this._ticks[0], this._ticks[this._ticks.length - 1]] : this._ticks.map(date);\n\n    this._labels = this._ticks;\n\n    super.render(callback);\n\n    const offset = this._outerBounds[y],\n          range = this._d3Scale.range();\n\n    const brush = this._brush = brushX()\n      .extent([[range[0], offset], [range[range.length - 1], offset + this._outerBounds[height]]])\n      .filter(this._brushFilter)\n      .handleSize(this._handleSize)\n      .on(\"start\", this._brushStart.bind(this))\n      .on(\"brush\", this._brushBrush.bind(this))\n      .on(\"end\", this._brushEnd.bind(this));\n\n    const latest = this._buttonBehaviorCurrent === \"ticks\"\n      ? this._availableTicks[this._availableTicks.length - 1]\n      : range[range.length - 1];\n\n    const selection = this._selection === void 0 ? [latest, latest]\n      : this._selection instanceof Array\n        ? this._buttonBehaviorCurrent === \"buttons\"\n          ? this._selection.map(d => range[this._ticks.map(Number).indexOf(+d)]).slice() : this._selection.slice()\n        : this._buttonBehaviorCurrent === \"buttons\"\n          ? [range[this._ticks.map(Number).indexOf(+this._selection)], range[this._ticks.map(Number).indexOf(+this._selection)]]\n          : [this._selection, this._selection];\n\n    this._updateBrushLimit(selection);\n\n    this._brushGroup = elem(\"g.brushGroup\", {parent: this._group});\n    this._brushGroup.call(brush).transition(this._transition)\n      .call(brush.move, this._buttonBehaviorCurrent === \"ticks\" ? this._updateBrushLimit(selection) : selection);\n\n    this._outerBounds.y -= this._handleSize / 2;\n    this._outerBounds.height += this._handleSize / 2;\n\n    return this;\n  }\n\n  /**\n        @memberof Timeline\n        @desc If *value* is specified, sets the button padding and returns the current class instance. If *value* is not specified, returns the current button padding.\n        @param {Number} [*value* = 10]\n        @chainable\n    */\n  buttonPadding(_) {\n    return arguments.length ? (this._buttonPadding = _, this) : this._buttonPadding;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, toggles the brushing value and returns the current class instance. If *value* is not specified, returns the current brushing value.\n      @param {Boolean} [*value* = true]\n      @chainable\n  */\n  brushing(_) {\n    return arguments.length ? (this._brushing = _, this) : this._brushing;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, sets the brush event filter and returns the current class instance. If *value* is not specified, returns the current brush event filter.\n      @param {Function} [*value*]\n      @chainable\n      @example\nfunction() {\n  return !event.button && event.detail < 2;\n}\n  */\n  brushFilter(_) {\n    return arguments.length ? (this._brushFilter = _, this) : this._brushFilter;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, toggles the horizontal alignment of the button timeline. Accepted values are `\"start\"`, `\"middle\"` and `\"end\"`. If *value* is not specified, returns the current button value.\n      @param {String} [*value* = \"middle\"]\n      @chainable\n  */\n  buttonAlign(_) {\n    return arguments.length ? (this._buttonAlign = _, this) : this._buttonAlign;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, toggles the style of the timeline. Accepted values are `\"auto\"`, `\"buttons\"` and `\"ticks\"`. If *value* is not specified, returns the current button value.\n      @param {String} [*value* = \"auto\"]\n      @chainable\n  */\n  buttonBehavior(_) {\n    return arguments.length ? (this._buttonBehavior = _, this) : this._buttonBehavior;\n  }\n\n  /**\n        @memberof Timeline\n        @desc If *value* is specified, sets the button height and returns the current class instance. If *value* is not specified, returns the current button height.\n        @param {Number} [*value* = 30]\n        @chainable\n    */\n  buttonHeight(_) {\n    return arguments.length ? (this._buttonHeight = _, this) : this._buttonHeight;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, sets the handle style and returns the current class instance. If *value* is not specified, returns the current handle style.\n      @param {Object} [*value*]\n      @chainable\n  */\n  handleConfig(_) {\n    return arguments.length ? (this._handleConfig = Object.assign(this._handleConfig, _), this) : this._handleConfig;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, sets the handle size and returns the current class instance. If *value* is not specified, returns the current handle size.\n      @param {Number} [*value* = 6]\n      @chainable\n  */\n  handleSize(_) {\n    return arguments.length ? (this._handleSize = _, this) : this._handleSize;\n  }\n\n  /**\n      @memberof Timeline\n      @desc Adds or removes a *listener* for the specified brush event *typename*. If a *listener* is not specified, returns the currently-assigned listener for the specified event *typename*. Mirrors the core [d3-brush](https://github.com/d3/d3-brush#brush_on) behavior.\n      @param {String|Object} [*typename*]\n      @param {Function} [*listener*]\n      @chainable\n  */\n  on(_, f) {\n    return arguments.length === 2 ? (this._on[_] = f, this) : arguments.length ? typeof _ === \"string\" ? this._on[_] : (this._on = Object.assign({}, this._on, _), this) : this._on;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, sets the selection style and returns the current class instance. If *value* is not specified, returns the current selection style.\n      @param {Object} [*value*]\n      @chainable\n  */\n  selectionConfig(_) {\n    return arguments.length ? (this._selectionConfig = Object.assign(this._selectionConfig, _), this) : this._selectionConfig;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, sets the selection and returns the current class instance. If *value* is not specified, returns the current selection. Defaults to the most recent year in the timeline.\n      @param {Array|Date|Number|String} [*value*]\n      @chainable\n  */\n  selection(_) {\n    return arguments.length ? (this._selection = _, this) : this._selection;\n  }\n\n  /**\n      @memberof Timeline\n      @desc If *value* is specified, toggles the snapping value and returns the current class instance. If *value* is not specified, returns the current snapping value.\n      @param {Boolean} [*value* = true]\n      @chainable\n  */\n  snapping(_) {\n    return arguments.length ? (this._snapping = _, this) : this._snapping;\n  }\n\n}\n"],"names":["Timeline","_barConfig","Object","assign","_buttonBehaviorCurrent","_brushing","_brushFilter","event","button","detail","_buttonAlign","_buttonBehavior","_buttonPadding","_buttonHeight","_domain","_gridSize","_handleConfig","fill","colorDefaults","dark","_handleSize","_height","_labelOffset","_on","orient","_scale","_selectionConfig","_shape","_shapeConfig","labelBounds","d","x","y","width","height","light","tick","_ticksWidth","_availableTicks","length","map","t","date","getTime","includes","id","_align","_margin","top","bottom","_snapping","sourceEvent","offsetX","selection","domain","_updateDomain","_brushGroup","call","_brush","move","_updateBrushLimit","_brushStyle","brush","_selection","transition","_transition","end","start","_position","timelineHeight","r","_tickSize","brushOverlay","selectAll","attr","brushSelection","attrize","brushHandle","yTransform","_marginLeft","pointer","_select","node","_d3Scale","invert","Number","type","diffs","Math","abs","sort","a","b","ticks","range","closest","single","indexOf","buttonWidth","callback","_ticks","d3Scale","scaleTime","_width","_tickFormat","tickFormat","_tickSpecifier","maxLabel","forEach","i","f","labelConfig","fontFamily","s","fontSize","wrap","textWrap","lineHeight","undefined","res","lines","ceil","max","line","textWidth","_labelRotation","Array","from","_","buttonMargin","marginRight","_range","_labels","offset","_outerBounds","brushX","extent","filter","handleSize","on","_brushStart","bind","_brushBrush","_brushEnd","latest","slice","elem","parent","_group","arguments","Axis"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}
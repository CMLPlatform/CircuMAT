{"version":3,"file":"d3plus-legend.js","sources":["../src/ckmeans.js","../src/Legend.js","../src/ColorScale.js"],"sourcesContent":["/**\n    @desc Sort an array of numbers by their numeric value, ensuring that the array is not changed in place.\n\nThis is necessary because the default behavior of .sort in JavaScript is to sort arrays as string values\n\n[1, 10, 12, 102, 20].sort()\n// output\n[1, 10, 102, 12, 20]\n\n    @param {Array<number>} array input array\n    @return {Array<number>} sorted array\n    @private\n    @example\nnumericSort([3, 2, 1]) // => [1, 2, 3]\n*/\nfunction numericSort(array) {\n  return array.slice().sort((a, b) => a - b);\n}\n\n/**\n    For a sorted input, counting the number of unique values is possible in constant time and constant memory. This is a simple implementation of the algorithm.\n\n    Values are compared with `===`, so objects and non-primitive objects are not handled in any special way.\n    @private\n    @param {Array} input an array of primitive values.\n    @returns {number} count of unique values\n    @example\nuniqueCountSorted([1, 2, 3]); // => 3\nuniqueCountSorted([1, 1, 1]); // => 1\n*/\nfunction uniqueCountSorted(input) {\n  let lastSeenValue, uniqueValueCount = 0;\n  for (let i = 0; i < input.length; i++) {\n    if (i === 0 || input[i] !== lastSeenValue) {\n      lastSeenValue = input[i];\n      uniqueValueCount++;\n    }\n  }\n  return uniqueValueCount;\n}\n\n/**\n    Create a new column x row matrix.\n    @private\n    @param {number} columns\n    @param {number} rows\n    @return {Array<Array<number>>} matrix\n    @example\nmakeMatrix(10, 10);\n*/\nfunction makeMatrix(columns, rows) {\n  const matrix = [];\n  for (let i = 0; i < columns; i++) {\n    const column = [];\n    for (let j = 0; j < rows; j++) column.push(0);\n    matrix.push(column);\n  }\n  return matrix;\n}\n\n/**\n    Generates incrementally computed values based on the sums and sums of squares for the data array\n    @private\n    @param {number} j\n    @param {number} i\n    @param {Array<number>} sums\n    @param {Array<number>} sumsOfSquares\n    @return {number}\n    @example\nssq(0, 1, [-1, 0, 2], [1, 1, 5]);\n*/\nfunction ssq(j, i, sums, sumsOfSquares) {\n  let sji; // s(j, i)\n\n  if (j > 0) {\n    const muji = (sums[i] - sums[j - 1]) / (i - j + 1); // mu(j, i)\n    sji = sumsOfSquares[i] - sumsOfSquares[j - 1] - (i - j + 1) * muji * muji;\n  }\n  else sji = sumsOfSquares[i] - sums[i] * sums[i] / (i + 1);\n\n  if (sji < 0) return 0;\n  return sji;\n}\n\n/**\n    Function that recursively divides and conquers computations for cluster j\n    @private\n    @param {number} iMin Minimum index in cluster to be computed\n    @param {number} iMax Maximum index in cluster to be computed\n    @param {number} cluster Index of the cluster currently being computed\n    @param {Array<Array<number>>} matrix\n    @param {Array<Array<number>>} backtrackMatrix\n    @param {Array<number>} sums\n    @param {Array<number>} sumsOfSquares\n*/\nfunction fillMatrixColumn(iMin, iMax, cluster, matrix, backtrackMatrix, sums, sumsOfSquares) {\n  if (iMin > iMax) return;\n\n  // Start at midpoint between iMin and iMax\n  const i = Math.floor((iMin + iMax) / 2);\n\n  matrix[cluster][i] = matrix[cluster - 1][i - 1];\n  backtrackMatrix[cluster][i] = i;\n\n  let jlow = cluster; // the lower end for j\n  if (iMin > cluster) jlow = Math.max(jlow, backtrackMatrix[cluster][iMin - 1] || 0);\n  jlow = Math.max(jlow, backtrackMatrix[cluster - 1][i] || 0);\n\n  let jhigh = i - 1; // the upper end for j\n  if (iMax < matrix.length - 1) jhigh = Math.min(jhigh, backtrackMatrix[cluster][iMax + 1] || 0);\n\n  for (let j = jhigh; j >= jlow; --j) {\n    const sji = ssq(j, i, sums, sumsOfSquares);\n\n    if (sji + matrix[cluster - 1][jlow - 1] >= matrix[cluster][i]) break;\n\n    // Examine the lower bound of the cluster border\n    const sjlowi = ssq(jlow, i, sums, sumsOfSquares);\n\n    const ssqjlow = sjlowi + matrix[cluster - 1][jlow - 1];\n\n    if (ssqjlow < matrix[cluster][i]) {\n      // Shrink the lower bound\n      matrix[cluster][i] = ssqjlow;\n      backtrackMatrix[cluster][i] = jlow;\n    }\n    jlow++;\n\n    const ssqj = sji + matrix[cluster - 1][j - 1];\n    if (ssqj < matrix[cluster][i]) {\n      matrix[cluster][i] = ssqj;\n      backtrackMatrix[cluster][i] = j;\n    }\n  }\n\n  fillMatrixColumn(iMin, i - 1, cluster, matrix, backtrackMatrix, sums, sumsOfSquares);\n  fillMatrixColumn(i + 1, iMax, cluster, matrix, backtrackMatrix, sums, sumsOfSquares);\n\n}\n\n/**\n    Initializes the main matrices used in Ckmeans and kicks off the divide and conquer cluster computation strategy\n    @private\n    @param {Array<number>} data sorted array of values\n    @param {Array<Array<number>>} matrix\n    @param {Array<Array<number>>} backtrackMatrix\n*/\nfunction fillMatrices(data, matrix, backtrackMatrix) {\n  const nValues = matrix[0] ? matrix[0].length : 0;\n\n  // Shift values by the median to improve numeric stability\n  const shift = data[Math.floor(nValues / 2)];\n\n  // Cumulative sum and cumulative sum of squares for all values in data array\n  const sums = [];\n  const sumsOfSquares = [];\n\n  // Initialize first column in matrix & backtrackMatrix\n  for (let i = 0, shiftedValue = void 0; i < nValues; ++i) {\n    shiftedValue = data[i] - shift;\n    if (i === 0) {\n      sums.push(shiftedValue);\n      sumsOfSquares.push(shiftedValue * shiftedValue);\n    }\n    else {\n      sums.push(sums[i - 1] + shiftedValue);\n      sumsOfSquares.push(sumsOfSquares[i - 1] + shiftedValue * shiftedValue);\n    }\n\n    // Initialize for cluster = 0\n    matrix[0][i] = ssq(0, i, sums, sumsOfSquares);\n    backtrackMatrix[0][i] = 0;\n  }\n\n  // Initialize the rest of the columns\n  for (let cluster = 1; cluster < matrix.length; ++cluster) {\n    let iMin = nValues - 1;\n    if (cluster < matrix.length - 1) iMin = cluster;\n    fillMatrixColumn(iMin, nValues - 1, cluster, matrix, backtrackMatrix, sums, sumsOfSquares);\n  }\n}\n\n/**\n    @desc Ported to ES6 from the excellent [simple-statistics](https://github.com/simple-statistics/simple-statistics) packages.\n\nCkmeans clustering is an improvement on heuristic-based clustering approaches like Jenks. The algorithm was developed in [Haizhou Wang and Mingzhou Song](http://journal.r-project.org/archive/2011-2/RJournal_2011-2_Wang+Song.pdf) as a [dynamic programming](https://en.wikipedia.org/wiki/Dynamic_programming) approach to the problem of clustering numeric data into groups with the least within-group sum-of-squared-deviations.\n\nMinimizing the difference within groups - what Wang & Song refer to as `withinss`, or within sum-of-squares, means that groups are optimally homogenous within and the data is split into representative groups. This is very useful for visualization, where you may want to represent a continuous variable in discrete color or style groups. This function can provide groups that emphasize differences between data.\n\nBeing a dynamic approach, this algorithm is based on two matrices that store incrementally-computed values for squared deviations and backtracking indexes.\n\nThis implementation is based on Ckmeans 3.4.6, which introduced a new divide and conquer approach that improved runtime from O(kn^2) to O(kn log(n)).\n\nUnlike the [original implementation](https://cran.r-project.org/web/packages/Ckmeans.1d.dp/index.html), this implementation does not include any code to automatically determine the optimal number of clusters: this information needs to be explicitly provided.\n\n### References\n_Ckmeans.1d.dp: Optimal k-means Clustering in One Dimension by Dynamic\nProgramming_ Haizhou Wang and Mingzhou Song ISSN 2073-4859 from The R Journal Vol. 3/2, December 2011\n    @param {Array<number>} data input data, as an array of number values\n    @param {number} nClusters number of desired classes. This cannot be greater than the number of values in the data array.\n    @returns {Array<Array<number>>} clustered input\n    @example\nckmeans([-1, 2, -1, 2, 4, 5, 6, -1, 2, -1], 3);\n// The input, clustered into groups of similar numbers.\n//= [[-1, -1, -1, -1], [2, 2, 2], [4, 5, 6]]);\n*/\nexport default function(data, nClusters) {\n\n  if (nClusters > data.length) {\n    throw new Error(\"Cannot generate more classes than there are data values\");\n  }\n\n  const sorted = numericSort(data);\n\n  // we'll use this as the maximum number of clusters\n  const uniqueCount = uniqueCountSorted(sorted);\n\n  // if all of the input values are identical, there's one cluster with all of the input in it.\n  if (uniqueCount === 1) {\n    return [sorted];\n  }\n\n  const backtrackMatrix = makeMatrix(nClusters, sorted.length),\n        matrix = makeMatrix(nClusters, sorted.length);\n\n  // This is a dynamic programming way to solve the problem of minimizing within-cluster sum of squares. It's similar to linear regression in this way, and this calculation incrementally computes the sum of squares that are later read.\n  fillMatrices(sorted, matrix, backtrackMatrix);\n\n  // The real work of Ckmeans clustering happens in the matrix generation: the generated matrices encode all possible clustering combinations, and once they're generated we can solve for the best clustering groups very quickly.\n  let clusterRight = backtrackMatrix[0] ? backtrackMatrix[0].length - 1 : 0;\n  const clusters = [];\n\n  // Backtrack the clusters from the dynamic programming matrix. This starts at the bottom-right corner of the matrix (if the top-left is 0, 0), and moves the cluster target with the loop.\n  for (let cluster = backtrackMatrix.length - 1; cluster >= 0; cluster--) {\n\n    const clusterLeft = backtrackMatrix[cluster][clusterRight];\n\n    // fill the cluster from the sorted input by taking a slice of the array. the backtrack matrix makes this easy - it stores the indexes where the cluster should start and end.\n    clusters[cluster] = sorted.slice(clusterLeft, clusterRight + 1);\n\n    if (cluster > 0) clusterRight = clusterLeft - 1;\n\n  }\n\n  return clusters;\n\n}\n","/**\n    @external BaseClass\n    @see https://github.com/d3plus/d3plus-common#BaseClass\n*/\n\nimport {max, sum} from \"d3-array\";\nimport {select} from \"d3-selection\";\n\nimport {accessor, assign, BaseClass, configPrep, constant, elem} from \"d3plus-common\";\nimport {colorDefaults} from \"d3plus-color\";\nimport * as shapes from \"d3plus-shape\";\nimport {TextBox, textWidth, textWrap} from \"d3plus-text\";\n\nconst padding = 5;\n\n/**\n    @class Legend\n    @extends external:BaseClass\n    @desc Creates an SVG scale based on an array of data. If *data* is specified, immediately draws based on the specified array and returns the current class instance. If *data* is not specified on instantiation, it can be passed/updated after instantiation using the [data](#shape.data) method.\n*/\nexport default class Legend extends BaseClass {\n\n  /**\n      @memberof Legend\n      @desc Invoked when creating a new class instance, and sets any default parameters.\n      @private\n  */\n  constructor() {\n\n    super();\n\n    this._titleClass = new TextBox();\n\n    this._align = \"center\";\n    this._data = [];\n    this._direction = \"row\";\n    this._duration = 600;\n    this._height = 200;\n    this._id = accessor(\"id\");\n    this._label = accessor(\"id\");\n    this._lineData = [];\n    this._outerBounds = {width: 0, height: 0, x: 0, y: 0};\n    this._padding = 5;\n    this._shape = constant(\"Rect\");\n    this._shapes = [];\n    this._shapeConfig = {\n      fill: accessor(\"color\"),\n      height: constant(12),\n      hitArea: (dd, i) => {\n        const d = this._lineData[i],\n              h = max([d.height, d.shapeHeight]);\n        return {width: d.width + d.shapeWidth, height: h, x: -d.shapeWidth / 2, y: -h / 2};\n      },\n      labelBounds: (dd, i) => {\n        const d = this._lineData[i];\n        let x = d.shapeWidth / 2;\n        if (d.shape === \"Circle\") x -= d.shapeR / 2;\n        const height = max([d.shapeHeight, d.height]);\n        return {width: d.width, height, x: x + padding, y: -height / 2};\n      },\n      labelConfig: {\n        fontColor: constant(colorDefaults.dark),\n        fontFamily: this._titleClass.fontFamily(),\n        fontResize: false,\n        fontSize: constant(10),\n        verticalAlign: \"middle\"\n      },\n      opacity: 1,\n      r: constant(6),\n      width: constant(12),\n      x: (d, i) => {\n        const datum = this._lineData[i];\n        const y = datum.y;\n        const pad = this._align === \"left\" || this._align === \"right\" && this._direction === \"column\" ? 0 : this._align === \"center\"\n          ? (this._outerBounds.width - this._rowWidth(this._lineData.filter(l => y === l.y))) / 2\n          : this._outerBounds.width - this._rowWidth(this._lineData.filter(l => y === l.y));\n        const prevWords = this._lineData.slice(0, i).filter(l => y === l.y);\n        return this._rowWidth(prevWords) + this._padding * (prevWords.length ? datum.sentence ? 2 : 1 : 0) +\n               this._outerBounds.x + datum.shapeWidth / 2 + pad;\n      },\n      y: (d, i) => {\n        const ld = this._lineData[i];\n        return ld.y + this._titleHeight + this._outerBounds.y +\n               max(\n                 this._lineData.filter(l => ld.y === l.y).map(l => l.height)\n                 .concat(this._data.map((l, x) => this._fetchConfig(\"height\", l, x)))\n               ) / 2;\n      }\n    };\n    this._titleConfig = {\n      fontSize: 12\n    };\n    this._verticalAlign = \"middle\";\n    this._width = 400;\n\n  }\n\n  _fetchConfig(key, d, i) {\n    const val = this._shapeConfig[key] !== undefined ? this._shapeConfig[key] : this._shapeConfig.labelConfig[key];\n    if (!val && key === \"lineHeight\") return this._fetchConfig(\"fontSize\", d, i) * 1.4;\n    return typeof val === \"function\" ? val(d, i) : val;\n  }\n\n  _rowHeight(row) {\n    return max(row.map(d => d.height).concat(row.map(d => d.shapeHeight))) + this._padding;\n  }\n\n  _rowWidth(row) {\n    return sum(row.map((d, i) => {\n      const p = this._padding * (i === row.length - 1 ? 0 : d.width ? 2 : 1);\n      return d.shapeWidth + d.width + p;\n    }));\n  }\n\n  /**\n      @memberof Legend\n      @desc Renders the current Legend to the page. If a *callback* is specified, it will be called once the legend is done drawing.\n      @param {Function} [*callback* = undefined]\n      @chainable\n  */\n  render(callback) {\n\n    if (this._select === void 0) this.select(select(\"body\").append(\"svg\").attr(\"width\", `${this._width}px`).attr(\"height\", `${this._height}px`).node());\n\n    // Legend Container <g> Groups\n    this._group = elem(\"g.d3plus-Legend\", {parent: this._select});\n    this._titleGroup = elem(\"g.d3plus-Legend-title\", {parent: this._group});\n    this._shapeGroup = elem(\"g.d3plus-Legend-shape\", {parent: this._group});\n\n    let availableHeight = this._height;\n    this._titleHeight = 0;\n    this._titleWidth = 0;\n    if (this._title) {\n\n      const f = this._titleConfig.fontFamily || this._titleClass.fontFamily()(),\n            s = this._titleConfig.fontSize || this._titleClass.fontSize()();\n      let lH = lH = this._titleConfig.lineHeight || this._titleClass.lineHeight();\n      lH = lH ? lH() : s * 1.4;\n\n      const res = textWrap()\n        .fontFamily(f)\n        .fontSize(s)\n        .lineHeight(lH)\n        .width(this._width)\n        .height(this._height)\n        (this._title);\n      this._titleHeight = lH + res.lines.length + this._padding;\n      this._titleWidth = max(res.widths);\n      availableHeight -= this._titleHeight;\n    }\n\n    // Calculate Text Sizes\n    this._lineData = this._data.map((d, i) => {\n\n      const label = this._label(d, i);\n      const shape = this._shape(d, i);\n      const r = this._fetchConfig(\"r\", d, i);\n\n      let res = {\n        data: d,\n        i,\n        id: this._id(d, i),\n        shape,\n        shapeR: r,\n        shapeWidth: shape === \"Circle\" ? r * 2 : this._fetchConfig(\"width\", d, i),\n        shapeHeight: shape === \"Circle\" ? r * 2 : this._fetchConfig(\"height\", d, i),\n        y: 0\n      };\n\n      if (!label) {\n        res.sentence = false;\n        res.words = [];\n        res.height = 0;\n        res.width = 0;\n        return res;\n      }\n\n      const f = this._fetchConfig(\"fontFamily\", d, i),\n            lh = this._fetchConfig(\"lineHeight\", d, i),\n            s = this._fetchConfig(\"fontSize\", d, i);\n\n      const h = availableHeight - (this._data.length + 1) * this._padding,\n            w = this._width;\n\n      res = Object.assign(res, textWrap()\n        .fontFamily(f)\n        .fontSize(s)\n        .lineHeight(lh)\n        .width(w)\n        .height(h)\n        (label));\n\n      res.width = Math.ceil(max(res.lines.map(t => textWidth(t, {\"font-family\": f, \"font-size\": s})))) + padding * 2;\n      res.height = Math.ceil(res.lines.length * (lh + 1));\n      res.og = {height: res.height, width: res.width};\n      res.f = f;\n      res.s = s;\n      res.lh = lh;\n\n      return res;\n\n    });\n\n    let spaceNeeded;\n    const availableWidth = this._width - this._padding * 2;\n    spaceNeeded = this._rowWidth(this._lineData);\n\n    if (this._direction === \"column\" || spaceNeeded > availableWidth) {\n      let lines = 1, newRows = [];\n\n      const maxLines = max(this._lineData.map(d => d.words.length));\n      this._wrapLines = function() {\n\n        lines++;\n\n        if (lines > maxLines) return;\n\n        const wrappable = lines === 1 ? this._lineData.slice()\n          : this._lineData.filter(d => d.width + d.shapeWidth + this._padding * (d.width ? 2 : 1) > availableWidth && d.words.length >= lines)\n              .sort((a, b) => b.sentence.length - a.sentence.length);\n\n        if (wrappable.length && availableHeight > wrappable[0].height * lines) {\n\n          let truncated = false;\n          for (let x = 0; x < wrappable.length; x++) {\n            const label = wrappable[x];\n            const h = label.og.height * lines, w = label.og.width * (1.5 * (1 / lines));\n            const res = textWrap().fontFamily(label.f).fontSize(label.s).lineHeight(label.lh).width(w).height(h)(label.sentence);\n            if (!res.truncated) {\n              label.width = Math.ceil(max(res.lines.map(t => textWidth(t, {\"font-family\": label.f, \"font-size\": label.s})))) + label.s;\n              label.height = res.lines.length * (label.lh + 1);\n            }\n            else {\n              truncated = true;\n              break;\n            }\n          }\n          if (!truncated) this._wrapRows();\n        }\n        else {\n          newRows = [];\n          return;\n        }\n\n      };\n\n      this._wrapRows = function() {\n        newRows = [];\n        let row = 1, rowWidth = 0;\n        for (let i = 0; i < this._lineData.length; i++) {\n          const d = this._lineData[i],\n                w = d.width + this._padding * (d.width ? 2 : 1) + d.shapeWidth;\n          if (sum(newRows.map(row => max(row, d => max([d.height, d.shapeHeight])))) > availableHeight) {\n            newRows = [];\n            break;\n          }\n          if (w > availableWidth) {\n            newRows = [];\n            this._wrapLines();\n            break;\n          }\n          else if (rowWidth + w < availableWidth) {\n            rowWidth += w;\n          }\n          else if (this._direction !== \"column\") {\n            rowWidth = w;\n            row++;\n          }\n          if (!newRows[row - 1]) newRows[row - 1] = [];\n          newRows[row - 1].push(d);\n          if (this._direction === \"column\") {\n            rowWidth = 0;\n            row++;\n          }\n        }\n      };\n\n      this._wrapRows();\n\n      if (!newRows.length || sum(newRows, this._rowHeight.bind(this)) + this._padding > availableHeight) {\n        spaceNeeded = sum(this._lineData.map(d => d.shapeWidth + this._padding)) - this._padding;\n        for (let i = 0; i < this._lineData.length; i++) {\n          this._lineData[i].width = 0;\n          this._lineData[i].height = 0;\n        }\n        this._wrapRows();\n      }\n\n      if (newRows.length && sum(newRows, this._rowHeight.bind(this)) + this._padding < availableHeight) {\n        newRows.forEach((row, i) => {\n          row.forEach(d => {\n            if (i) {\n              d.y = sum(newRows.slice(0, i), this._rowHeight.bind(this));\n            }\n          });\n        });\n        spaceNeeded = max(newRows, this._rowWidth.bind(this));\n      }\n    }\n\n    const innerHeight = max(this._lineData, (d, i) => max([d.height, this._fetchConfig(\"height\", d.data, i)]) + d.y) + this._titleHeight,\n          innerWidth = max([spaceNeeded, this._titleWidth]);\n\n    this._outerBounds.width = innerWidth;\n    this._outerBounds.height = innerHeight;\n\n    let xOffset = this._padding,\n        yOffset = this._padding;\n    if (this._align === \"center\") xOffset = (this._width - innerWidth) / 2;\n    else if (this._align === \"right\") xOffset = this._width - this._padding - innerWidth;\n    if (this._verticalAlign === \"middle\") yOffset = (this._height - innerHeight) / 2;\n    else if (this._verticalAlign === \"bottom\") yOffset = this._height - this._padding - innerHeight;\n    this._outerBounds.x = xOffset;\n    this._outerBounds.y = yOffset;\n\n    this._titleClass\n      .data(this._title ? [{text: this._title}] : [])\n      .duration(this._duration)\n      .select(this._titleGroup.node())\n      .textAnchor({left: \"start\", center: \"middle\", right: \"end\"}[this._align])\n      .width(this._width - this._padding * 2)\n      .x(this._padding)\n      .y(this._outerBounds.y)\n      .config(this._titleConfig)\n      .render();\n\n    this._shapes = [];\n    const baseConfig = configPrep.bind(this)(this._shapeConfig, \"legend\"),\n          config = {\n            id: d => d.id,\n            label: d => d.label,\n            lineHeight: d => d.lH\n          };\n\n    const data = this._data.map((d, i) => {\n\n      const obj = {\n        __d3plus__: true,\n        data: d, i,\n        id: this._id(d, i),\n        label: this._lineData[i].width ? this._label(d, i) : false,\n        lH: this._fetchConfig(\"lineHeight\", d, i),\n        shape: this._shape(d, i)\n      };\n\n      return obj;\n\n    });\n\n    // Legend Shapes\n    this._shapes = [];\n    [\"Circle\", \"Rect\"].forEach(Shape => {\n\n      this._shapes.push(\n        new shapes[Shape]()\n          .parent(this)\n          .data(data.filter(d => d.shape === Shape))\n          .duration(this._duration)\n          .labelConfig({padding: 0})\n          .select(this._shapeGroup.node())\n          .verticalAlign(\"top\")\n          .config(assign({}, baseConfig, config))\n          .render()\n      );\n\n    });\n\n    if (callback) setTimeout(callback, this._duration + 100);\n\n    return this;\n\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the active method for all shapes to the specified function and returns the current class instance. If *value* is not specified, returns the current active method.\n      @param {Function} [*value*]\n      @chainable\n  */\n  active(_) {\n    this._shapes.forEach(s => s.active(_));\n    return this;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the horizontal alignment to the specified value and returns the current class instance. If *value* is not specified, returns the current horizontal alignment.\n      @param {String} [*value* = \"center\"] Supports `\"left\"` and `\"center\"` and `\"right\"`.\n      @chainable\n  */\n  align(_) {\n    return arguments.length ? (this._align = _, this) : this._align;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *data* is specified, sets the data array to the specified array and returns the current class instance. If *data* is not specified, returns the current data array. A shape key will be drawn for each object in the array.\n      @param {Array} [*data* = []]\n      @chainable\n  */\n  data(_) {\n    return arguments.length ? (this._data = _, this) : this._data;\n  }\n\n  /**\n      @memberof Legend\n      @desc Sets the flow of the items inside the legend. If no value is passed, the current flow will be returned.\n      @param {String} [*value* = \"row\"]\n      @chainable\n  */\n  direction(_) {\n    return arguments.length ? (this._direction = _, this) : this._direction;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the transition duration of the legend and returns the current class instance. If *value* is not specified, returns the current duration.\n      @param {Number} [*value* = 600]\n      @chainable\n  */\n  duration(_) {\n    return arguments.length ? (this._duration = _, this) : this._duration;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the overall height of the legend and returns the current class instance. If *value* is not specified, returns the current height value.\n      @param {Number} [*value* = 100]\n      @chainable\n  */\n  height(_) {\n    return arguments.length ? (this._height = _, this) : this._height;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the hover method for all shapes to the specified function and returns the current class instance. If *value* is not specified, returns the current hover method.\n      @param {Function} [*value*]\n      @chainable\n  */\n  hover(_) {\n    this._shapes.forEach(s => s.hover(_));\n    return this;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the id accessor to the specified function and returns the current class instance. If *value* is not specified, returns the current id accessor.\n      @param {Function} [*value*]\n      @chainable\n      @example\nfunction value(d) {\n  return d.id;\n}\n  */\n  id(_) {\n    return arguments.length ? (this._id = _, this) : this._id;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the label accessor to the specified function or string and returns the current class instance. If *value* is not specified, returns the current label accessor, which is the [id](#shape.id) accessor by default.\n      @param {Function|String} [*value*]\n      @chainable\n  */\n  label(_) {\n    return arguments.length ? (this._label = typeof _ === \"function\" ? _ : constant(_), this) : this._label;\n  }\n\n  /**\n      @memberof Legend\n      @desc If called after the elements have been drawn to DOM, will returns the outer bounds of the legend content.\n      @example\n{\"width\": 180, \"height\": 24, \"x\": 10, \"y\": 20}\n  */\n  outerBounds() {\n    return this._outerBounds;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the padding between each key to the specified number and returns the current class instance. If *value* is not specified, returns the current padding value.\n      @param {Number} [*value* = 10]\n      @chainable\n  */\n  padding(_) {\n    return arguments.length ? (this._padding = _, this) : this._padding;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *selector* is specified, sets the SVG container element to the specified d3 selector or DOM element and returns the current class instance. If *selector* is not specified, returns the current SVG container element.\n      @param {String|HTMLElement} [*selector* = d3.select(\"body\").append(\"svg\")]\n      @chainable\n  */\n  select(_) {\n    return arguments.length ? (this._select = select(_), this) : this._select;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the shape accessor to the specified function or string and returns the current class instance. If *value* is not specified, returns the current shape accessor.\n      @param {Function|String} [*value* = \"Rect\"]\n      @chainable\n  */\n  shape(_) {\n    return arguments.length ? (this._shape = typeof _ === \"function\" ? _ : constant(_), this) : this._shape;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *config* is specified, sets the methods that correspond to the key/value pairs for each shape and returns the current class instance. If *config* is not specified, returns the current shape configuration.\n      @param {Object} [*config* = {}]\n      @chainable\n  */\n  shapeConfig(_) {\n    return arguments.length ? (this._shapeConfig = assign(this._shapeConfig, _), this) : this._shapeConfig;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the title of the legend and returns the current class instance. If *value* is not specified, returns the current title.\n      @param {String} [*value*]\n      @chainable\n  */\n  title(_) {\n    return arguments.length ? (this._title = _, this) : this._title;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the title configuration of the legend and returns the current class instance. If *value* is not specified, returns the current title configuration.\n      @param {Object} [*value*]\n      @chainable\n  */\n  titleConfig(_) {\n    return arguments.length ? (this._titleConfig = assign(this._titleConfig, _), this) : this._titleConfig;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the vertical alignment to the specified value and returns the current class instance. If *value* is not specified, returns the current vertical alignment.\n      @param {String} [*value* = \"middle\"] Supports `\"top\"` and `\"middle\"` and `\"bottom\"`.\n      @chainable\n  */\n  verticalAlign(_) {\n    return arguments.length ? (this._verticalAlign = _, this) : this._verticalAlign;\n  }\n\n  /**\n      @memberof Legend\n      @desc If *value* is specified, sets the overall width of the legend and returns the current class instance. If *value* is not specified, returns the current width value.\n      @param {Number} [*value* = 400]\n      @chainable\n  */\n  width(_) {\n    return arguments.length ? (this._width = _, this) : this._width;\n  }\n\n}\n","/**\n    @external BaseClass\n    @see https://github.com/d3plus/d3plus-common#BaseClass\n*/\n\nimport ckmeans from \"./ckmeans\";\nimport Legend from \"./Legend\";\n\nimport {extent, max, min, quantile, range, deviation} from \"d3-array\";\nimport {scaleLinear, scaleThreshold} from \"d3-scale\";\nimport {select} from \"d3-selection\";\nimport {transition} from \"d3-transition\";\n\nimport {Axis} from \"d3plus-axis\";\nimport {colorDefaults, colorLighter} from \"d3plus-color\";\nimport {accessor, assign, BaseClass, constant, elem, unique} from \"d3plus-common\";\nimport {formatAbbreviate} from \"d3plus-format\";\nimport {Rect} from \"d3plus-shape\";\nimport {TextBox, textWidth} from \"d3plus-text\";\n\n/**\n    @class ColorScale\n    @extends external:BaseClass\n    @desc Creates an SVG scale based on an array of data. If *data* is specified, immediately draws based on the specified array and returns the current class instance. If *data* is not specified on instantiation, it can be passed/updated after instantiation using the [data](#shape.data) method.\n*/\nexport default class ColorScale extends BaseClass {\n\n  /**\n      @memberof ColorScale\n      @desc Invoked when creating a new class instance, and sets any default parameters.\n      @private\n  */\n  constructor() {\n\n    super();\n\n    this._axisClass = new Axis();\n    this._axisConfig = {\n      gridSize: 0\n    };\n    this._axisTest = new Axis();\n    this._align = \"middle\";\n    this._buckets = 5;\n    this._bucketAxis = false;\n    this._bucketFormat = (tick, i, ticks, allValues) => {\n\n      const format = this._axisConfig.tickFormat\n        ? this._axisConfig.tickFormat : formatAbbreviate;\n\n      const next = ticks[i + 1];\n      const prev = i ? ticks[i - 1] : false;\n      const last = i === ticks.length - 1;\n      if (tick === next || last) {\n        const suffix = last && tick < max(allValues) ? \"+\" : \"\";\n        return `${format(tick)}${suffix}`;\n      }\n      else {\n        const mod = next ? next / 100 : tick / 100;\n\n        const pow = mod >= 1 || mod <= -1 ? Math.round(mod).toString().length - 1 : mod.toString().split(\".\")[1].replace(/([1-9])[1-9].*$/, \"$1\").length * -1;\n        const ten = Math.pow(10, pow);\n\n        const prevValue = prev === tick && i === 1\n          ? format(min([tick + ten, allValues.find(d => d > tick && d < next)]))\n          : format(tick);\n\n        const nextValue = tick && i === 1\n          ? format(next)\n          : format(max([next - ten, allValues.reverse().find(d => d > tick && d < next)]));\n\n        return this._bucketJoiner(prevValue, nextValue);\n\n      }\n    };\n    this._bucketJoiner = (a, b) => a !== b ? `${a} - ${b}` : `${a}`;\n    this._centered = true;\n    this._color = [\"#54478C\", \"#2C699A\", \"#0DB39E\", \"#83E377\", \"#EFEA5A\"];\n    this._colorMax = colorDefaults.on;\n    this._colorMid = colorDefaults.light;\n    this._colorMin = colorDefaults.off;\n    this._data = [];\n    this._duration = 600;\n    this._height = 200;\n    this._labelClass = new TextBox();\n    this._labelConfig = {\n      fontColor: colorDefaults.dark,\n      fontSize: 12\n    };\n    this._legendClass = new Legend();\n    this._legendConfig = {\n      shapeConfig: {\n        stroke: colorDefaults.dark,\n        strokeWidth: 1\n      }\n    };\n    this._midpoint = 0;\n    this._orient = \"bottom\";\n    this._outerBounds = {width: 0, height: 0, x: 0, y: 0};\n    this._padding = 5;\n    this._rectClass = new Rect().parent(this);\n    this._rectConfig = {\n      stroke: \"#999\",\n      strokeWidth: 1\n    };\n    this._scale = \"linear\";\n    this._size = 10;\n    this._value = accessor(\"value\");\n    this._width = 400;\n\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Renders the current ColorScale to the page. If a *callback* is specified, it will be called once the ColorScale is done drawing.\n      @param {Function} [*callback* = undefined]\n      @chainable\n  */\n  render(callback) {\n\n    if (this._select === void 0) this.select(select(\"body\").append(\"svg\").attr(\"width\", `${this._width}px`).attr(\"height\", `${this._height}px`).node());\n\n    const horizontal = [\"bottom\", \"top\"].includes(this._orient);\n\n    const height = horizontal ? \"height\" : \"width\",\n          width = horizontal ? \"width\" : \"height\",\n          x = horizontal ? \"x\" : \"y\",\n          y = horizontal ? \"y\" : \"x\";\n\n    // Shape <g> Group\n    this._group = elem(\"g.d3plus-ColorScale\", {parent: this._select});\n\n    const allValues = this._data\n      .map(this._value)\n      .filter(d => d !== null && typeof d === \"number\")\n      .sort((a, b) => a - b);\n\n    const domain = this._domain || extent(allValues);\n    const negative = domain[0] < this._midpoint;\n    const positive = domain[1] > this._midpoint;\n    const diverging = negative && positive;\n\n    const numBuckets = min([\n      this._buckets instanceof Array ? this._buckets.length : this._buckets,\n      unique(allValues).length\n    ]);\n\n    let colors = this._color, labels, ticks;\n\n    if (colors && !(colors instanceof Array)) {\n      colors = range(0, numBuckets, 1)\n        .map(i => colorLighter(colors, (i + 1) / numBuckets))\n        .reverse();\n    }\n\n    if (this._scale === \"jenks\") {\n\n      const buckets = min([colors ? colors.length : numBuckets, numBuckets, allValues.length]);\n\n      let jenks = [];\n\n      if (this._buckets instanceof Array) {\n        ticks = this._buckets;\n      }\n      else {\n\n        if (diverging && this._centered) {\n\n          const half = Math.floor(buckets / 2);\n          const residual = buckets % 2;\n\n          const negatives = allValues.filter(d => d < this._midpoint);\n          const negativesDeviation = deviation(negatives);\n\n          const positives = allValues.concat(this._midpoint).filter(d => d >= this._midpoint);\n          const positivesDeviation = deviation(positives);\n\n          const isNegativeMax = negativesDeviation > positivesDeviation ? 1 : 0;\n          const isPositiveMax = positivesDeviation > negativesDeviation ? 1 : 0;\n\n          const negativeJenks = ckmeans(negatives, half + residual * isNegativeMax);\n          const positiveJenks = ckmeans(positives, half + residual * isPositiveMax);\n\n          jenks = negativeJenks.concat(positiveJenks);\n        }\n        else {\n          jenks = ckmeans(allValues, buckets);\n        }\n\n        ticks = jenks.map(c => c[0]);\n\n      }\n\n      const tickSet = new Set(ticks);\n\n      if (ticks.length !== tickSet.size) {\n        labels = Array.from(tickSet);\n      }\n\n      if (!colors) {\n        if (diverging) {\n          colors = [this._colorMin, this._colorMid, this._colorMax];\n          const negatives = ticks\n            .slice(0, buckets)\n            .filter((d, i) => d < this._midpoint && ticks[i + 1] <= this._midpoint);\n          const spanning = ticks\n            .slice(0, buckets)\n            .filter((d, i) => d <= this._midpoint && ticks[i + 1] > this._midpoint);\n          const positives = ticks\n            .slice(0, buckets)\n            .filter((d, i) => d > this._midpoint && ticks[i + 1] > this._midpoint);\n          const negativeColors = negatives.map((d, i) => !i ? colors[0] : colorLighter(colors[0], i / negatives.length));\n          const spanningColors = spanning.map(() => colors[1]);\n          const positiveColors = positives.map((d, i) => i === positives.length - 1 ? colors[2] : colorLighter(colors[2], 1 - (i + 1) / positives.length));\n          colors = negativeColors.concat(spanningColors).concat(positiveColors);\n        }\n        else {\n          colors = range(0, numBuckets, 1)\n            .map(i => colorLighter(this._colorMax, i / numBuckets))\n            .reverse();\n        }\n      }\n\n      if (allValues.length <= buckets) {\n        colors = colors.slice(buckets - allValues.length);\n      }\n\n      colors = [colors[0]].concat(colors);\n\n      this._colorScale = scaleThreshold()\n        .domain(ticks)\n        .range(colors);\n\n    }\n    else {\n\n      let buckets = this._buckets instanceof Array ? this._buckets : undefined;\n      if (diverging && !colors) {\n        const half = Math.floor(numBuckets / 2);\n        const negativeColors = range(0, half, 1).map(i => !i ? this._colorMin : colorLighter(this._colorMin, i / half));\n        const spanningColors = (numBuckets % 2 ? [0] : []).map(() => this._colorMid);\n        const positiveColors = range(0, half, 1).map(i => !i ? this._colorMax : colorLighter(this._colorMax, i / half)).reverse();\n        colors = negativeColors.concat(spanningColors).concat(positiveColors);\n        if (!buckets) {\n          const step = (colors.length - 1) / 2;\n          buckets = [domain[0], this._midpoint, domain[1]];\n          buckets = range(domain[0], this._midpoint, -(domain[0] - this._midpoint) / step)\n            .concat(range(this._midpoint, domain[1], (domain[1] - this._midpoint) / step))\n            .concat([domain[1]]);\n        }\n      }\n      else {\n        if (!colors) {\n          if (this._scale === \"buckets\" || this._scale === \"quantile\") {\n            colors = range(0, numBuckets, 1)\n              .map(i => colorLighter(negative ? this._colorMin : this._colorMax, i / numBuckets));\n            if (positive) colors = colors.reverse();\n          }\n          else {\n            colors = negative ? [this._colorMin, colorLighter(this._colorMin, 0.8)]\n              : [colorLighter(this._colorMax, 0.8), this._colorMax];\n          }\n        }\n        if (!buckets) {\n          if (this._scale === \"quantile\") {\n            const step = 1 / (colors.length - 1);\n            buckets = range(0, 1 + step / 2, step)\n              .map(d => quantile(allValues, d));\n          }\n          else if (diverging && this._color && this._centered) {\n            const negativeStep = (this._midpoint - domain[0]) / Math.floor(colors.length / 2);\n            const positiveStep = (domain[1] - this._midpoint) / Math.floor(colors.length / 2);\n            const negativeBuckets = range(domain[0], this._midpoint, negativeStep);\n            const positiveBuckets = range(this._midpoint, domain[1] + positiveStep / 2, positiveStep);\n\n            buckets = negativeBuckets.concat(positiveBuckets);\n          }\n          else {\n            const step = (domain[1] - domain[0]) / (colors.length - 1);\n            buckets = range(domain[0], domain[1] + step / 2, step);\n          }\n        }\n      }\n\n      if (this._scale === \"buckets\" || this._scale === \"quantile\") {\n        ticks = buckets;\n        colors = [colors[0]].concat(colors);\n      }\n      else if (this._scale === \"log\") {\n        const negativeBuckets = buckets.filter(d => d < 0);\n        if (negativeBuckets.length) {\n          const minVal = negativeBuckets[0];\n          const newNegativeBuckets = negativeBuckets.map(d => -Math.pow(Math.abs(minVal), d / minVal));\n          negativeBuckets.forEach((bucket, i) => {\n            buckets[buckets.indexOf(bucket)] = newNegativeBuckets[i];\n          });\n        }\n        const positiveBuckets = buckets.filter(d => d > 0);\n        if (positiveBuckets.length) {\n          const maxVal = positiveBuckets[positiveBuckets.length - 1];\n          const newPositiveBuckets = positiveBuckets.map(d => Math.pow(maxVal, d / maxVal));\n          positiveBuckets.forEach((bucket, i) => {\n            buckets[buckets.indexOf(bucket)] = newPositiveBuckets[i];\n          });\n        }\n        if (buckets.includes(0)) buckets[buckets.indexOf(0)] = 1;\n      }\n\n      this._colorScale = (this._scale === \"buckets\" || this._scale === \"quantile\" ? scaleThreshold : scaleLinear)()\n        .domain(buckets)\n        .range(colors);\n\n    }\n\n    if (this._colorScale.clamp) this._colorScale.clamp(true);\n\n    const gradient = this._bucketAxis || ![\"buckets\", \"jenks\", \"quantile\"].includes(this._scale);\n    const t = transition().duration(this._duration);\n    const groupParams = {enter: {opacity: 0}, exit: {opacity: 0}, parent: this._group, transition: t, update: {opacity: 1}};\n    const labelGroup = elem(\"g.d3plus-ColorScale-labels\", Object.assign({condition: gradient}, groupParams));\n    const rectGroup = elem(\"g.d3plus-ColorScale-Rect\", Object.assign({condition: gradient}, groupParams));\n    const legendGroup = elem(\"g.d3plus-ColorScale-legend\", Object.assign({condition: !gradient}, groupParams));\n\n    if (gradient) {\n\n      const offsets = {x: 0, y: 0};\n\n      const axisDomain = domain.slice();\n      if (this._bucketAxis) {\n        const last = axisDomain[axisDomain.length - 1];\n        const prev = axisDomain[axisDomain.length - 2];\n        const mod = last ? last / 10 : prev / 10;\n\n        const pow = mod >= 1 || mod <= -1 ? Math.round(mod).toString().length - 1 : mod.toString().split(\".\")[1].replace(/([1-9])[1-9].*$/, \"$1\").length * -1;\n        const ten = Math.pow(10, pow);\n        axisDomain[axisDomain.length - 1] = last + ten;\n      }\n\n      const axisConfig = assign({\n        domain: horizontal ? axisDomain : axisDomain.slice().reverse(),\n        duration: this._duration,\n        height: this._height,\n        labels: labels || ticks,\n        orient: this._orient,\n        padding: this._padding,\n        scale: this._scale === \"log\" ? \"log\" : \"linear\",\n        ticks,\n        width: this._width\n      }, this._axisConfig);\n\n      const labelConfig = assign({\n        height: this[`_${height}`] / 2,\n        width: this[`_${width}`] / 2\n      }, this._labelConfig);\n\n      this._labelClass.config(labelConfig);\n      const labelData = [];\n\n      if (horizontal && this._labelMin) {\n\n        const labelCSS = {\n          \"font-family\": this._labelClass.fontFamily()(this._labelMin),\n          \"font-size\": this._labelClass.fontSize()(this._labelMin),\n          \"font-weight\": this._labelClass.fontWeight()(this._labelMin)\n        };\n\n        if (labelCSS[\"font-family\"] instanceof Array) labelCSS[\"font-family\"] = labelCSS[\"font-family\"][0];\n        let labelMinWidth = textWidth(this._labelMin, labelCSS);\n\n        if (labelMinWidth && labelMinWidth < this[`_${width}`] / 2) {\n          labelData.push(this._labelMin);\n          labelMinWidth += this._padding;\n          if (horizontal) offsets.x += labelMinWidth;\n          axisConfig[width] -= labelMinWidth;\n        }\n\n      }\n      if (horizontal && this._labelMax) {\n\n        const labelCSS = {\n          \"font-family\": this._labelClass.fontFamily()(this._labelMax),\n          \"font-size\": this._labelClass.fontSize()(this._labelMax),\n          \"font-weight\": this._labelClass.fontWeight()(this._labelMax)\n        };\n\n        if (labelCSS[\"font-family\"] instanceof Array) labelCSS[\"font-family\"] = labelCSS[\"font-family\"][0];\n        let labelMaxWidth = textWidth(this._labelMax, labelCSS);\n\n        if (labelMaxWidth && labelMaxWidth < this[`_${width}`] / 2) {\n          labelData.push(this._labelMax);\n          labelMaxWidth += this._padding;\n          if (!horizontal) offsets.y += labelMaxWidth;\n          axisConfig[width] -= labelMaxWidth;\n        }\n\n      }\n\n      this._axisTest\n        .select(elem(\"g.d3plus-ColorScale-axisTest\", {enter: {opacity: 0}, parent: this._group}).node())\n        .config(axisConfig)\n        .duration(0)\n        .render();\n\n      const axisBounds = this._axisTest.outerBounds();\n\n      this._outerBounds[width] = this[`_${width}`] - this._padding * 2;\n      this._outerBounds[height] = axisBounds[height] + this._size;\n\n      this._outerBounds[x] = this._padding;\n      this._outerBounds[y] = this._padding;\n      if (this._align === \"middle\") this._outerBounds[y] = (this[`_${height}`] - this._outerBounds[height]) / 2;\n      else if (this._align === \"end\") this._outerBounds[y] = this[`_${height}`] - this._padding - this._outerBounds[height];\n\n      const axisGroupOffset = this._outerBounds[y] + ([\"bottom\", \"right\"].includes(this._orient) ? this._size : 0) - (axisConfig.padding || this._axisClass.padding());\n      const transform = `translate(${offsets.x + (horizontal ? 0 : axisGroupOffset)}, ${offsets.y + (horizontal ? axisGroupOffset : 0)})`;\n      this._axisClass\n        .select(elem(\"g.d3plus-ColorScale-axis\", assign(groupParams, {\n          condition: true,\n          enter: {transform},\n          update: {transform}\n        })).node())\n        .config(axisConfig)\n        .align(\"start\")\n        .render();\n\n      const axisScale = this._axisTest._getPosition.bind(this._axisTest);\n      const scaleRange = this._axisTest._getRange();\n\n      let defs = this._group.selectAll(\"defs\").data([0]);\n      const defsEnter = defs.enter().append(\"defs\");\n      defsEnter.append(\"linearGradient\").attr(\"id\", `gradient-${this._uuid}`);\n      defs = defsEnter.merge(defs);\n      defs.select(\"linearGradient\")\n        .attr(`${x}1`, horizontal ? \"0%\" : \"100%\")\n        .attr(`${x}2`, horizontal ? \"100%\" : \"0%\")\n        .attr(`${y}1`, \"0%\")\n        .attr(`${y}2`, \"0%\");\n      const stops = defs.select(\"linearGradient\").selectAll(\"stop\")\n        .data(colors);\n      const scaleDomain = this._colorScale.domain();\n      const offsetScale = scaleLinear()\n        .domain(scaleRange)\n        .range(horizontal ? [0, 100] : [100, 0]);\n\n      stops.enter().append(\"stop\").merge(stops)\n        .attr(\"offset\", (d, i) => `${i <= scaleDomain.length - 1 ? offsetScale(axisScale(scaleDomain[i])) : 100}%`)\n        .attr(\"stop-color\", String);\n\n      /** determines the width of buckets */\n      const bucketWidth = (d, i) => {\n        const next = ticks[i + 1] || axisDomain[axisDomain.length - 1];\n        return Math.abs(axisScale(next) - axisScale(d));\n      };\n\n      const rectConfig = assign({\n        duration: this._duration,\n        fill: ticks ? d => this._colorScale(d) : `url(#gradient-${this._uuid})`,\n        [x]: ticks ? (d, i) => axisScale(d) + bucketWidth(d, i) / 2 - ([\"left\", \"right\"].includes(this._orient) ? bucketWidth(d, i) : 0) : scaleRange[0] + (scaleRange[1] - scaleRange[0]) / 2 + offsets[x],\n        [y]: this._outerBounds[y] + ([\"top\", \"left\"].includes(this._orient) ? axisBounds[height] : 0) + this._size / 2 + offsets[y],\n        [width]: ticks ? bucketWidth : scaleRange[1] - scaleRange[0],\n        [height]: this._size\n      }, this._rectConfig);\n\n      this._rectClass\n        .data(ticks || [0])\n        .id((d, i) => i)\n        .select(rectGroup.node())\n        .config(rectConfig)\n        .render();\n\n      labelConfig.height = this._outerBounds[height];\n      labelConfig.width = this._outerBounds[width];\n      this._labelClass\n        .config(labelConfig)\n        .data(labelData)\n        .select(labelGroup.node())\n        .x(d => d === this._labelMax\n          ? rectConfig.x + rectConfig.width / 2 + this._padding\n          : this._outerBounds.x)\n        .y(d => rectConfig.y - this._labelClass.fontSize()(d) / 2)\n        .text(d => d)\n        .rotate(horizontal ? 0 : this._orient === \"right\" ? 90 : -90)\n        .render();\n\n    }\n    else {\n\n      elem(\"g.d3plus-ColorScale-axis\", Object.assign({condition: gradient}, groupParams));\n\n      let legendData = ticks.reduce((arr, tick, i) => {\n\n        const label = this._bucketFormat.bind(this)(tick, i, ticks, allValues);\n        arr.push({color: colors[i + 1], id: label});\n\n        return arr;\n      }, []);\n      if (!horizontal) legendData = legendData.reverse();\n\n      const legendConfig = assign({\n        align: horizontal ? \"center\" : {start: \"left\", middle: \"center\", end: \"right\"}[this._align],\n        direction: horizontal ? \"row\" : \"column\",\n        duration: this._duration,\n        height: this._height,\n        padding: this._padding,\n        shapeConfig: assign({\n          duration: this._duration\n        }, this._axisConfig.shapeConfig || {}),\n        title: this._axisConfig.title,\n        titleConfig: this._axisConfig.titleConfig || {},\n        width: this._width,\n        verticalAlign: horizontal ? {start: \"top\", middle: \"middle\", end: \"bottom\"}[this._align] : \"middle\"\n      }, this._legendConfig);\n\n      this._legendClass\n        .data(legendData)\n        .select(legendGroup.node())\n        .config(legendConfig)\n        .render();\n\n      this._outerBounds = this._legendClass.outerBounds();\n\n    }\n\n    if (callback) setTimeout(callback, this._duration + 100);\n\n    return this;\n\n  }\n\n  /**\n      @memberof ColorScale\n      @desc The [ColorScale](http://d3plus.org/docs/#ColorScale) is constructed by combining an [Axis](http://d3plus.org/docs/#Axis) for the ticks/labels and a [Rect](http://d3plus.org/docs/#Rect) for the actual color box (or multiple boxes, as in a jenks scale). Because of this, there are separate configs for the [Axis](http://d3plus.org/docs/#Axis) class used to display the text ([axisConfig](http://d3plus.org/docs/#ColorScale.axisConfig)) and the [Rect](http://d3plus.org/docs/#Rect) class used to draw the color breaks ([rectConfig](http://d3plus.org/docs/#ColorScale.rectConfig)). This method acts as a pass-through to the config method of the [Axis](http://d3plus.org/docs/#Axis). An example usage of this method can be seen [here](http://d3plus.org/examples/d3plus-legend/colorScale-dark/).\n      @param {Object} [*value*]\n      @chainable\n  */\n  axisConfig(_) {\n    return arguments.length ? (this._axisConfig = assign(this._axisConfig, _), this) : this._axisConfig;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the horizontal alignment to the specified value and returns the current class instance. If *value* is not specified, returns the current horizontal alignment.\n      @param {String} [*value* = \"center\"] Supports `\"left\"` and `\"center\"` and `\"right\"`.\n      @chainable\n  */\n  align(_) {\n    return arguments.length ? (this._align = _, this) : this._align;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc The number of discrete buckets to create in a bucketed color scale. Will be overridden by any custom Array of colors passed to the `color` method. Optionally, users can supply an Array of values used to separate buckets, such as `[0, 10, 25, 50, 90]` for a percentage scale. This value would create 4 buckets, with each value representing the break point between each bucket (so 5 values makes 4 buckets).\n      @param {Number|Array} [*value* = 5]\n      @chainable\n  */\n  buckets(_) {\n    return arguments.length ? (this._buckets = _, this) : this._buckets;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Determines whether or not to use an Axis to display bucket scales (both \"buckets\" and \"jenks\"). When set to `false`, bucketed scales will use the `Legend` class to display squares for each range of data. When set to `true`, bucketed scales will be displayed on an `Axis`, similar to \"linear\" scales.\n      @param {Boolean} [*value* = false]\n      @chainable\n  */\n  bucketAxis(_) {\n    return arguments.length ? (this._bucketAxis = _, this) : this._bucketAxis;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc A function for formatting the labels associated to each bucket in a bucket-type scale (\"jenks\", \"quantile\", etc). The function is passed four arguments: the start value of the current bucket, it's index in the full Array of buckets, the full Array of buckets, and an Array of every value present in the data used to construct the buckets. Keep in mind that the end value for the bucket is not actually the next bucket in the list, but includes every value up until that next bucket value (less than, but not equal to). By default, d3plus will make the end value slightly less than it's current value, so that it does not overlap with the start label for the next bucket.\n      @param {Function} [*value*]\n      @chainable\n  */\n  bucketFormat(_) {\n    return arguments.length ? (this._bucketFormat = _, this) : this._bucketFormat;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc A function that receives the minimum and maximum values of a bucket, and is expected to return the full label.\n      @param {Function} [*value*]\n      @chainable\n  */\n  bucketJoiner(_) {\n    return arguments.length ? (this._bucketJoiner = _, this) : this._bucketJoiner;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Determines whether or not to display a midpoint centered Axis. Does not apply to quantile scales.\n      @param {Boolean} [*value* = false]\n      @chainable\n  */\n\n  centered(_) {\n    return arguments.length ? (this._centered = _, this) : this._centered;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Overrides the default internal logic of `colorMin`, `colorMid`, and `colorMax` to only use just this specified color. If a single color is given as a String, then the scale is interpolated by lightening that color. Otherwise, the function expects an Array of color values to be used in order for the scale.\n      @param {String|Array} [*value*]\n      @chainable\n  */\n  color(_) {\n    return arguments.length ? (this._color = _, this) : this._color;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Defines the color to be used for numbers greater than the value of the `midpoint` on the scale (defaults to `0`). Colors in between this value and the value of `colorMid` will be interpolated, unless a custom Array of colors has been specified using the `color` method.\n      @param {String} [*value* = \"#0C8040\"]\n      @chainable\n  */\n  colorMax(_) {\n    return arguments.length ? (this._colorMax = _, this) : this._colorMax;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Defines the color to be used for the midpoint of a diverging scale, based on the current value of the `midpoint` method (defaults to `0`). Colors in between this value and the values of `colorMin` and `colorMax` will be interpolated, unless a custom Array of colors has been specified using the `color` method.\n      @param {String} [*value* = \"#f7f7f7\"]\n      @chainable\n  */\n  colorMid(_) {\n    return arguments.length ? (this._colorMid = _, this) : this._colorMid;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Defines the color to be used for numbers less than the value of the `midpoint` on the scale (defaults to `0`). Colors in between this value and the value of `colorMid` will be interpolated, unless a custom Array of colors has been specified using the `color` method.\n      @param {String} [*value* = \"#b22200\"]\n      @chainable\n  */\n  colorMin(_) {\n    return arguments.length ? (this._colorMin = _, this) : this._colorMin;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *data* is specified, sets the data array to the specified array and returns the current class instance. If *data* is not specified, returns the current data array. A shape key will be drawn for each object in the array.\n      @param {Array} [*data* = []]\n      @chainable\n  */\n  data(_) {\n    return arguments.length ? (this._data = _, this) : this._data;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc In a linear scale, this Array of 2 values defines the min and max values used in the color scale. Any values outside of this range will be mapped to the nearest color value.\n      @param {Array} [*value*]\n      @chainable\n  */\n  domain(_) {\n    return arguments.length ? (this._domain = _, this) : this._domain;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the transition duration of the ColorScale and returns the current class instance. If *value* is not specified, returns the current duration.\n      @param {Number} [*value* = 600]\n      @chainable\n  */\n  duration(_) {\n    return arguments.length ? (this._duration = _, this) : this._duration;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the overall height of the ColorScale and returns the current class instance. If *value* is not specified, returns the current height value.\n      @param {Number} [*value* = 100]\n      @chainable\n  */\n  height(_) {\n    return arguments.length ? (this._height = _, this) : this._height;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc A pass-through for the [TextBox](http://d3plus.org/docs/#TextBox) class used to style the labelMin and labelMax text.\n      @param {Object} [*value*]\n      @chainable\n  */\n  labelConfig(_) {\n    return arguments.length ? (this._labelConfig = assign(this._labelConfig, _), this) : this._labelConfig;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Defines a text label to be displayed off of the end of the minimum point in the scale (currently only available in horizontal orientation).\n      @param {String} [*value*]\n      @chainable\n  */\n  labelMin(_) {\n    return arguments.length ? (this._labelMin = _, this) : this._labelMin;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Defines a text label to be displayed off of the end of the maximum point in the scale (currently only available in horizontal orientation).\n      @param {String} [*value*]\n      @chainable\n  */\n  labelMax(_) {\n    return arguments.length ? (this._labelMax = _, this) : this._labelMax;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc The [ColorScale](http://d3plus.org/docs/#ColorScale) is constructed by combining an [Axis](http://d3plus.org/docs/#Axis) for the ticks/labels and a [Rect](http://d3plus.org/docs/#Rect) for the actual color box (or multiple boxes, as in a jenks scale). Because of this, there are separate configs for the [Axis](http://d3plus.org/docs/#Axis) class used to display the text ([axisConfig](http://d3plus.org/docs/#ColorScale.axisConfig)) and the [Rect](http://d3plus.org/docs/#Rect) class used to draw the color breaks ([rectConfig](http://d3plus.org/docs/#ColorScale.rectConfig)). This method acts as a pass-through to the config method of the [Axis](http://d3plus.org/docs/#Axis). An example usage of this method can be seen [here](http://d3plus.org/examples/d3plus-legend/colorScale-dark/).\n      @param {Object} [*value*]\n      @chainable\n  */\n  legendConfig(_) {\n    return arguments.length ? (this._legendConfig = assign(this._legendConfig, _), this) : this._legendConfig;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc The number value to be used as the anchor for `colorMid`, and defines the center point of the diverging color scale.\n      @param {Number} [*value* = 0]\n      @chainable\n  */\n  midpoint(_) {\n    return arguments.length ? (this._midpoint = _, this) : this._midpoint;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc Sets the flow of the items inside the ColorScale. If no value is passed, the current flow will be returned.\n      @param {String} [*value* = \"bottom\"]\n      @chainable\n  */\n  orient(_) {\n    return arguments.length ? (this._orient = _, this) : this._orient;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If called after the elements have been drawn to DOM, will returns the outer bounds of the ColorScale content.\n      @example\n{\"width\": 180, \"height\": 24, \"x\": 10, \"y\": 20}\n  */\n  outerBounds() {\n    return this._outerBounds;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the padding between each key to the specified number and returns the current class instance. If *value* is not specified, returns the current padding value.\n      @param {Number} [*value* = 10]\n      @chainable\n  */\n  padding(_) {\n    return arguments.length ? (this._padding = _, this) : this._padding;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc The [ColorScale](http://d3plus.org/docs/#ColorScale) is constructed by combining an [Axis](http://d3plus.org/docs/#Axis) for the ticks/labels and a [Rect](http://d3plus.org/docs/#Rect) for the actual color box (or multiple boxes, as in a jenks scale). Because of this, there are separate configs for the [Axis](http://d3plus.org/docs/#Axis) class used to display the text ([axisConfig](http://d3plus.org/docs/#ColorScale.axisConfig)) and the [Rect](http://d3plus.org/docs/#Rect) class used to draw the color breaks ([rectConfig](http://d3plus.org/docs/#ColorScale.rectConfig)). This method acts as a pass-through to the config method of the [Rect](http://d3plus.org/docs/#Rect). An example usage of this method can be seen [here](http://d3plus.org/examples/d3plus-legend/colorScale-dark/).\n      @param {Object} [*value*]\n      @chainable\n  */\n  rectConfig(_) {\n    return arguments.length ? (this._rectConfig = assign(this._rectConfig, _), this) : this._rectConfig;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the scale of the ColorScale and returns the current class instance. If *value* is not specified, returns the current scale value.\n      @param {String} [*value* = \"linear\"] Can either be \"linear\", \"jenks\", or \"buckets\".\n      @chainable\n  */\n  scale(_) {\n    return arguments.length ? (this._scale = _, this) : this._scale;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *selector* is specified, sets the SVG container element to the specified d3 selector or DOM element and returns the current class instance. If *selector* is not specified, returns the current SVG container element.\n      @param {String|HTMLElement} [*selector* = d3.select(\"body\").append(\"svg\")]\n      @chainable\n  */\n  select(_) {\n    return arguments.length ? (this._select = select(_), this) : this._select;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc The height of horizontal color scales, and width when positioned vertical.\n      @param {Number} [*value* = 10]\n      @chainable\n  */\n  size(_) {\n    return arguments.length ? (this._size = _, this) : this._size;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the value accessor to the specified function or string and returns the current class instance. If *value* is not specified, returns the current value accessor.\n      @param {Function|String} [*value*]\n      @chainable\n      @example\nfunction value(d) {\n  return d.value;\n}\n  */\n  value(_) {\n    return arguments.length ? (this._value = typeof _ === \"function\" ? _ : constant(_), this) : this._value;\n  }\n\n  /**\n      @memberof ColorScale\n      @desc If *value* is specified, sets the overall width of the ColorScale and returns the current class instance. If *value* is not specified, returns the current width value.\n      @param {Number} [*value* = 400]\n      @chainable\n  */\n  width(_) {\n    return arguments.length ? (this._width = _, this) : this._width;\n  }\n\n}\n"],"names":["numericSort","array","slice","sort","a","b","uniqueCountSorted","input","lastSeenValue","uniqueValueCount","i","length","makeMatrix","columns","rows","matrix","column","j","push","ssq","sums","sumsOfSquares","sji","muji","fillMatrixColumn","iMin","iMax","cluster","backtrackMatrix","Math","floor","jlow","max","jhigh","min","sjlowi","ssqjlow","ssqj","fillMatrices","data","nValues","shift","shiftedValue","nClusters","Error","sorted","uniqueCount","clusterRight","clusters","clusterLeft","padding","Legend","_titleClass","TextBox","_align","_data","_direction","_duration","_height","_id","accessor","_label","_lineData","_outerBounds","width","height","x","y","_padding","_shape","constant","_shapes","_shapeConfig","fill","hitArea","dd","d","h","shapeHeight","shapeWidth","labelBounds","shape","shapeR","labelConfig","fontColor","colorDefaults","dark","fontFamily","fontResize","fontSize","verticalAlign","opacity","r","datum","pad","_rowWidth","filter","l","prevWords","sentence","ld","_titleHeight","map","concat","_fetchConfig","_titleConfig","_verticalAlign","_width","key","val","undefined","row","sum","p","callback","_select","select","append","attr","node","_group","elem","parent","_titleGroup","_shapeGroup","availableHeight","_titleWidth","_title","f","s","lH","lineHeight","res","textWrap","lines","widths","label","id","words","lh","w","Object","assign","ceil","t","textWidth","og","spaceNeeded","availableWidth","newRows","maxLines","_wrapLines","wrappable","truncated","_wrapRows","rowWidth","_rowHeight","bind","forEach","innerHeight","innerWidth","xOffset","yOffset","text","duration","textAnchor","left","center","right","config","render","baseConfig","configPrep","obj","__d3plus__","Shape","shapes","setTimeout","_","active","arguments","hover","BaseClass","ColorScale","_axisClass","Axis","_axisConfig","gridSize","_axisTest","_buckets","_bucketAxis","_bucketFormat","tick","ticks","allValues","format","tickFormat","formatAbbreviate","next","prev","last","suffix","mod","pow","round","toString","split","replace","ten","prevValue","find","nextValue","reverse","_bucketJoiner","_centered","_color","_colorMax","on","_colorMid","light","_colorMin","off","_labelClass","_labelConfig","_legendClass","_legendConfig","shapeConfig","stroke","strokeWidth","_midpoint","_orient","_rectClass","Rect","_rectConfig","_scale","_size","_value","horizontal","includes","domain","_domain","extent","negative","positive","diverging","numBuckets","Array","unique","colors","labels","range","colorLighter","buckets","jenks","half","residual","negatives","negativesDeviation","deviation","positives","positivesDeviation","isNegativeMax","isPositiveMax","negativeJenks","ckmeans","positiveJenks","c","tickSet","Set","size","from","spanning","negativeColors","spanningColors","positiveColors","_colorScale","scaleThreshold","step","quantile","negativeStep","positiveStep","negativeBuckets","positiveBuckets","minVal","newNegativeBuckets","abs","bucket","indexOf","maxVal","newPositiveBuckets","scaleLinear","clamp","gradient","transition","groupParams","enter","exit","update","labelGroup","condition","rectGroup","legendGroup","offsets","axisDomain","axisConfig","orient","scale","labelData","_labelMin","labelCSS","fontWeight","labelMinWidth","_labelMax","labelMaxWidth","axisBounds","outerBounds","axisGroupOffset","transform","align","axisScale","_getPosition","scaleRange","_getRange","defs","selectAll","defsEnter","_uuid","merge","stops","scaleDomain","offsetScale","String","bucketWidth","rectConfig","rotate","legendData","reduce","arr","color","legendConfig","start","middle","end","direction","title","titleConfig"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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"}